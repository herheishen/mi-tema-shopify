{{ 'quick-order-list.css' | asset_url | stylesheet_tag }}

<style>
  /* ========== BULK QUICK ORDER LIST ULTRA PRO 2025 ========== */

  /* Base animations */
  @keyframes slide-in-left {
    from {
      opacity: 0;
      transform: translateX(-20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes fade-scale {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes shimmer-loading {
    0% {
      background-position: -1000px 0;
    }
    100% {
      background-position: 1000px 0;
    }
  }

  @keyframes float-up {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes pulse-ring {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(var(--color-primary, 0, 0), 0.7);
    }
    50% {
      box-shadow: 0 0 0 8px rgba(var(--color-primary, 0, 0), 0);
    }
  }

  /* Quick order list container */
  .quick-order-list-section {
    animation: fade-scale 0.6s ease-out;
  }

  /* Product table with glassmorphism */
  .quick-order-list {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(0, 0, 0, 0.1);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .quick-order-list:hover {
    box-shadow: 0 12px 48px 0 rgba(31, 38, 135, 0.15);
    backdrop-filter: blur(15px);
  }

  /* Table head styling */
  .quick-order-list__head {
    background: linear-gradient(135deg, rgba(0, 0, 0, 0.03) 0%, rgba(0, 0, 0, 0.01) 100%);
    border-bottom: 2px solid rgba(0, 0, 0, 0.08);
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .quick-order-list__head th {
    padding: 16px 12px;
    text-align: left;
    font-weight: 600;
    font-size: 0.875rem;
    letter-spacing: 0.5px;
    text-transform: uppercase;
    color: rgba(0, 0, 0, 0.7);
    transition: all 0.3s ease;
  }

  /* Table row animations */
  .quick-order-list__row {
    animation: slide-in-left 0.4s ease-out;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
  }

  .quick-order-list__row:hover {
    background: rgba(0, 0, 0, 0.02);
    transform: translateX(2px);
  }

  .quick-order-list__row:active {
    background: rgba(0, 0, 0, 0.04);
  }

  /* Cell styling */
  .quick-order-list__cell {
    padding: 14px 12px;
    vertical-align: middle;
    transition: all 0.2s ease;
  }

  /* Product image with lazy load */
  .quick-order-list__image {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 8px;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    filter: brightness(0.95);
  }

  .quick-order-list__row:hover .quick-order-list__image {
    filter: brightness(1.05);
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  /* Product name */
  .quick-order-list__product-name {
    font-weight: 500;
    font-size: 0.95rem;
    line-height: 1.4;
    transition: all 0.3s ease;
  }

  .quick-order-list__row:hover .quick-order-list__product-name {
    color: var(--color-link);
  }

  /* SKU badge */
  .quick-order-list__sku {
    display: inline-block;
    padding: 4px 8px;
    background: rgba(0, 0, 0, 0.06);
    border-radius: 4px;
    font-size: 0.75rem;
    font-family: 'Courier New', monospace;
    font-weight: 600;
    color: rgba(0, 0, 0, 0.6);
    margin-top: 4px;
    animation: float-up 0.5s ease-out 0.1s both;
  }

  /* Quantity input with modern design */
  .quick-order-list__quantity-input {
    display: flex;
    align-items: center;
    gap: 0;
    background: rgba(255, 255, 255, 0.8);
    border: 1.5px solid rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s ease;
  }

  .quick-order-list__quantity-input:focus-within {
    border-color: var(--color-link);
    box-shadow: 0 0 0 3px rgba(var(--color-link-rgb, 0, 0), 0.1);
  }

  .quick-order-list__quantity-input input {
    width: 50px;
    padding: 8px 0;
    border: none;
    background: transparent;
    text-align: center;
    font-weight: 600;
    font-size: 0.95rem;
  }

  .quick-order-list__quantity-input input:focus {
    outline: none;
  }

  .quick-order-list__quantity-button {
    width: 36px;
    height: 36px;
    padding: 0;
    border: none;
    background: transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
    color: rgba(0, 0, 0, 0.6);
  }

  .quick-order-list__quantity-button:hover {
    background: rgba(0, 0, 0, 0.05);
    color: var(--color-link);
    transform: scale(1.1);
  }

  .quick-order-list__quantity-button:active {
    transform: scale(0.95);
  }

  /* Price display */
  .quick-order-list__price {
    font-weight: 600;
    font-size: 1rem;
    transition: all 0.3s ease;
  }

  .quick-order-list__price--original {
    text-decoration: line-through;
    color: rgba(0, 0, 0, 0.4);
    font-size: 0.875rem;
    margin-right: 8px;
  }

  .quick-order-list__price--sale {
    color: #d32f2f;
    animation: pulse-ring 2s infinite;
  }

  /* Add to cart button */
  .quick-order-list__add-button {
    padding: 10px 16px;
    background: var(--color-link);
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
    box-shadow: 0 4px 12px rgba(var(--color-link-rgb, 0, 0), 0.3);
    position: relative;
    overflow: hidden;
  }

  .quick-order-list__add-button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
  }

  .quick-order-list__add-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(var(--color-link-rgb, 0, 0), 0.4);
  }

  .quick-order-list__add-button:hover::before {
    width: 300px;
    height: 300px;
  }

  .quick-order-list__add-button:active {
    transform: translateY(0);
  }

  /* Loading state */
  .quick-order-list__loading {
    background: linear-gradient(
      90deg,
      rgba(0, 0, 0, 0.05) 0%,
      rgba(0, 0, 0, 0.1) 50%,
      rgba(0, 0, 0, 0.05) 100%
    );
    background-size: 1000px 100%;
    animation: shimmer-loading 2s infinite;
  }

  /* Empty state */
  .quick-order-list__empty {
    text-align: center;
    padding: 40px 20px;
    animation: float-up 0.6s ease-out;
  }

  .quick-order-list__empty-icon {
    width: 64px;
    height: 64px;
    margin: 0 auto 16px;
    opacity: 0.3;
  }

  .quick-order-list__empty-text {
    font-size: 0.95rem;
    color: rgba(0, 0, 0, 0.6);
    margin-bottom: 16px;
  }

  /* Responsive design */
  @media (max-width: 768px) {
    .quick-order-list {
      border-radius: 8px;
    }

    .quick-order-list__cell {
      padding: 12px 8px;
      font-size: 0.875rem;
    }

    .quick-order-list__image {
      width: 50px;
      height: 50px;
    }

    .quick-order-list__quantity-button {
      width: 32px;
      height: 32px;
    }

    .quick-order-list__add-button {
      padding: 8px 12px;
      font-size: 0.8rem;
    }
  }

  /* Tablet optimization */
  @media (max-width: 1024px) {
    .quick-order-list__head th {
      padding: 12px 8px;
      font-size: 0.8rem;
    }

    .quick-order-list__product-name {
      font-size: 0.9rem;
    }
  }

  /* Touch device optimizations */
  @media (hover: none) and (pointer: coarse) {
    .quick-order-list__quantity-button {
      width: 44px;
      height: 44px;
      min-width: 44px;
      min-height: 44px;
    }

    .quick-order-list__add-button {
      padding: 12px 20px;
      font-size: 0.9rem;
      min-height: 44px;
    }

    .quick-order-list__row:hover {
      transform: none;
    }
  }

  /* Dark mode support */
  @media (prefers-color-scheme: dark) {
    .quick-order-list {
      background: rgba(30, 30, 35, 0.7);
      border-color: rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
    }

    .quick-order-list:hover {
      box-shadow: 0 12px 48px 0 rgba(0, 0, 0, 0.4);
    }

    .quick-order-list__head {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.05) 0%, rgba(255, 255, 255, 0.02) 100%);
      border-bottom-color: rgba(255, 255, 255, 0.1);
    }

    .quick-order-list__head th {
      color: rgba(255, 255, 255, 0.7);
    }

    .quick-order-list__row:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .quick-order-list__quantity-input {
      background: rgba(50, 50, 55, 0.8);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .quick-order-list__quantity-input:focus-within {
      border-color: var(--color-link);
      box-shadow: 0 0 0 3px rgba(var(--color-link-rgb, 255, 255, 255), 0.1);
    }

    .quick-order-list__sku {
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.6);
    }

    .quick-order-list__quantity-button:hover {
      background: rgba(255, 255, 255, 0.1);
      color: var(--color-link);
    }

    .quick-order-list__empty-text {
      color: rgba(255, 255, 255, 0.6);
    }
  }

  /* Motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .quick-order-list-section,
    .quick-order-list,
    .quick-order-list__row,
    .quick-order-list__sku {
      animation: none;
    }

    .quick-order-list,
    .quick-order-list__image,
    .quick-order-list__row,
    .quick-order-list__quantity-button,
    .quick-order-list__add-button {
      transition: none;
    }
  }

  /* High contrast mode */
  @media (prefers-contrast: more) {
    .quick-order-list {
      border-width: 2px;
    }

    .quick-order-list__quantity-input {
      border-width: 2px;
    }

    .quick-order-list__head th {
      font-weight: 700;
    }
  }

  /* Print styles */
  @media print {
    .quick-order-list__quantity-button,
    .quick-order-list__add-button {
      display: none;
    }
  }
</style>

<script src="{{ 'quick-order-list.js' | asset_url }}" defer="defer"></script>

<script>
  // ========== BULK QUICK ORDER LIST ULTRA PRO 2025 ==========
  class BulkQuickOrderListUltraPro {
    constructor(container) {
      this.container = container;
      this.table = container.querySelector('.quick-order-list');
      this.rows = container.querySelectorAll('.quick-order-list__row');
      this.addButtons = container.querySelectorAll('.quick-order-list__add-button');
      this.quantityInputs = container.querySelectorAll('.quick-order-list__quantity-input input');
      
      this.init();
    }

    init() {
      this.setupEventListeners();
      this.setupIntersectionObserver();
      this.setupAccessibility();
      this.setupPerformance();
      this.logMetrics('BulkQuickOrderList initialized');
    }

    setupEventListeners() {
      // Quantity input changes
      this.quantityInputs.forEach((input) => {
        input.addEventListener('change', (e) => this.handleQuantityChange(e));
        input.addEventListener('focus', (e) => this.handleQuantityFocus(e));
        input.addEventListener('blur', (e) => this.handleQuantityBlur(e));
      });

      // Add to cart buttons
      this.addButtons.forEach((btn) => {
        btn.addEventListener('click', (e) => this.handleAddToCart(e));
      });

      // Keyboard shortcuts
      this.container.addEventListener('keydown', (e) => this.handleKeyboardShortcuts(e));

      // Row selection with checkbox
      const checkboxes = this.container.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach((checkbox) => {
        checkbox.addEventListener('change', (e) => this.handleRowSelection(e));
      });
    }

    setupIntersectionObserver() {
      const options = {
        threshold: 0.2,
        rootMargin: '0px',
      };

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = '1';
            entry.target.style.transform = 'translateX(0)';
            observer.unobserve(entry.target);
          }
        });
      }, options);

      this.rows.forEach((row) => {
        row.style.opacity = '0';
        row.style.transform = 'translateX(-20px)';
        observer.observe(row);
      });
    }

    setupAccessibility() {
      // Table role
      if (this.table) {
        this.table.setAttribute('role', 'grid');
      }

      // Row roles
      this.rows.forEach((row, index) => {
        row.setAttribute('role', 'row');
        row.setAttribute('aria-rowindex', index + 2);

        // Cell roles
        const cells = row.querySelectorAll('td');
        cells.forEach((cell, cellIndex) => {
          cell.setAttribute('role', 'gridcell');
          cell.setAttribute('aria-colindex', cellIndex + 1);
        });
      });

      // Button labels
      this.addButtons.forEach((btn, index) => {
        const productName = btn.closest('.quick-order-list__row')?.querySelector('.quick-order-list__product-name')?.textContent;
        btn.setAttribute('aria-label', `Add ${productName || 'Product'} to cart`);
      });

      // Quantity input labels
      this.quantityInputs.forEach((input, index) => {
        const productName = input.closest('.quick-order-list__row')?.querySelector('.quick-order-list__product-name')?.textContent;
        input.setAttribute('aria-label', `Quantity for ${productName || 'Product'}`);
      });
    }

    setupPerformance() {
      // Lazy load images in table
      const images = this.container.querySelectorAll('img[data-src]');
      if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              const img = entry.target;
              img.src = img.dataset.src;
              img.removeAttribute('data-src');
              imageObserver.unobserve(img);
            }
          });
        });

        images.forEach((img) => imageObserver.observe(img));
      }
    }

    handleQuantityChange(e) {
      const input = e.target;
      const value = parseInt(input.value) || 0;

      // Validate quantity
      if (value < 0) {
        input.value = 0;
        return;
      }

      // Update row styling
      const row = input.closest('.quick-order-list__row');
      if (value === 0) {
        row.style.opacity = '0.6';
      } else {
        row.style.opacity = '1';
      }

      // Dispatch custom event
      this.dispatchQuantityEvent(input, value);
    }

    handleQuantityFocus(e) {
      const input = e.target;
      input.select();
    }

    handleQuantityBlur(e) {
      const input = e.target;
      const value = parseInt(input.value) || 0;
      input.value = Math.max(0, value);
    }

    handleAddToCart(e) {
      e.preventDefault();
      const btn = e.currentTarget;
      const row = btn.closest('.quick-order-list__row');
      const productId = row?.dataset.productId;
      const quantity = row?.querySelector('input[type="number"]')?.value || 1;

      // Add ripple effect
      this.createRipple(btn, e);

      // Animate button
      btn.style.animation = 'none';
      void btn.offsetWidth; // Trigger reflow
      btn.style.animation = 'pulse-ring 0.6s ease-out';

      // Track event
      this.trackAddToCart(productId, quantity);

      // Emit event for cart integration
      this.dispatchCartEvent(productId, quantity);
    }

    handleKeyboardShortcuts(e) {
      // Enter to add to cart
      if (e.key === 'Enter' && e.ctrlKey) {
        const activeRow = this.container.querySelector('.quick-order-list__row:focus-within');
        if (activeRow) {
          const addBtn = activeRow.querySelector('.quick-order-list__add-button');
          addBtn?.click();
        }
      }

      // Arrow keys for quantity
      if ((e.key === 'ArrowUp' || e.key === 'ArrowDown') && e.target.tagName === 'INPUT') {
        e.preventDefault();
        const input = e.target;
        const currentValue = parseInt(input.value) || 0;
        const increment = e.key === 'ArrowUp' ? 1 : -1;
        input.value = Math.max(0, currentValue + increment);
        this.handleQuantityChange({ target: input });
      }
    }

    handleRowSelection(e) {
      const checkbox = e.target;
      const row = checkbox.closest('.quick-order-list__row');
      
      if (checkbox.checked) {
        row.style.background = 'rgba(0, 0, 0, 0.03)';
        row.style.borderLeft = '4px solid var(--color-link)';
      } else {
        row.style.background = '';
        row.style.borderLeft = '';
      }
    }

    createRipple(btn, e) {
      const ripple = document.createElement('span');
      const rect = btn.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const x = e.clientX - rect.left - size / 2;
      const y = e.clientY - rect.top - size / 2;

      ripple.style.cssText = `
        position: absolute;
        width: ${size}px;
        height: ${size}px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 50%;
        left: ${x}px;
        top: ${y}px;
        pointer-events: none;
        animation: ripple-animation 0.6s ease-out;
      `;

      btn.style.position = 'relative';
      btn.style.overflow = 'hidden';
      btn.appendChild(ripple);

      setTimeout(() => ripple.remove(), 600);
    }

    dispatchQuantityEvent(input, quantity) {
      const event = new CustomEvent('quantity-changed', {
        detail: {
          quantity,
          input,
        },
      });
      this.container.dispatchEvent(event);
    }

    dispatchCartEvent(productId, quantity) {
      const event = new CustomEvent('add-to-cart', {
        detail: {
          productId,
          quantity,
        },
      });
      this.container.dispatchEvent(event);
    }

    trackAddToCart(productId, quantity) {
      if (window.gtag) {
        gtag('event', 'add_to_cart', {
          items: [
            {
              item_id: productId,
              quantity: parseInt(quantity),
            },
          ],
        });
      }
    }

    logMetrics(message) {
      if (window.performance && window.performance.mark) {
        performance.mark(message);
      }
    }

    destroy() {
      this.quantityInputs.forEach((input) => {
        input.removeEventListener('change', this.handleQuantityChange);
      });
      this.addButtons.forEach((btn) => {
        btn.removeEventListener('click', this.handleAddToCart);
      });
    }
  }

  // Initialize on DOM ready
  document.addEventListener('DOMContentLoaded', function () {
    const containers = document.querySelectorAll('.quick-order-list-section');
    containers.forEach((container) => {
      new BulkQuickOrderListUltraPro(container);
    });
  });

  // Reinitialize on theme:section:load
  document.addEventListener('theme:section:load', function (e) {
    const container = e.detail.target.querySelector('.quick-order-list-section');
    if (container) {
      new BulkQuickOrderListUltraPro(container);
    }
  });
</script>

{% render 'quick-order-list', product: product, show_image: true, show_sku: true, is_modal: true %}


{% schema %}
{
  "name": "t:sections.quick-order-list.name",
  "limit": 1,
  "enabled_on": {
    "templates": ["product"]
  }
}
{% endschema %}
